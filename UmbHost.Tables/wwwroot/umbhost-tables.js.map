{"version":3,"file":"umbhost-tables.js","sources":["../../UmbHost.Tables.Client/src/types.ts","../../UmbHost.Tables.Client/src/table-property-editor.element.ts"],"sourcesContent":["/**\n * Represents a single cell within the table.\n */\nexport interface TableCell {\n  value: string;\n  type: 'Td' | 'Th';\n  colspan: number;\n  rowspan: number;\n}\n\n/**\n * Represents a row containing multiple cells.\n */\nexport interface TableRow {\n  cells: TableCell[];\n}\n\n/**\n * The complete table data model.\n */\nexport interface TableData {\n  rows: TableRow[];\n  useFirstRowAsHeader: boolean;\n  useFirstColumnAsHeader: boolean;\n}\n\n/**\n * Configuration options from the property editor settings.\n */\nexport interface TableConfiguration {\n  showUseFirstRowAsHeader?: boolean;\n  showUseFirstColumnAsHeader?: boolean;\n  defaultRows?: number;\n  defaultColumns?: number;\n  minRows?: number;\n  maxRows?: number;\n  minColumns?: number;\n  maxColumns?: number;\n  enableRichText?: boolean;\n}\n\n/**\n * Creates an empty cell with default values.\n */\nexport function createEmptyCell(isHeader: boolean = false): TableCell {\n  return {\n    value: '',\n    type: isHeader ? 'Th' : 'Td',\n    colspan: 1,\n    rowspan: 1\n  };\n}\n\n/**\n * Creates an empty row with the specified number of cells.\n */\nexport function createEmptyRow(columnCount: number, isHeaderRow: boolean = false): TableRow {\n  return {\n    cells: Array.from({ length: columnCount }, () => createEmptyCell(isHeaderRow))\n  };\n}\n\n/**\n * Creates an empty table with the specified dimensions.\n */\nexport function createEmptyTable(\n  rowCount: number = 3,\n  columnCount: number = 3,\n  useFirstRowAsHeader: boolean = false,\n  useFirstColumnAsHeader: boolean = false\n): TableData {\n  const rows: TableRow[] = [];\n  \n  for (let i = 0; i < rowCount; i++) {\n    const isHeaderRow = useFirstRowAsHeader && i === 0;\n    const row: TableRow = { cells: [] };\n    \n    for (let j = 0; j < columnCount; j++) {\n      const isHeaderCell = isHeaderRow || (useFirstColumnAsHeader && j === 0);\n      row.cells.push(createEmptyCell(isHeaderCell));\n    }\n    \n    rows.push(row);\n  }\n  \n  return {\n    rows,\n    useFirstRowAsHeader,\n    useFirstColumnAsHeader\n  };\n}\n","import { LitElement, html, css, nothing } from '@umbraco-cms/backoffice/external/lit';\nimport { customElement, property, state } from '@umbraco-cms/backoffice/external/lit';\nimport type { UmbPropertyEditorUiElement, UmbPropertyEditorConfigCollection } from '@umbraco-cms/backoffice/property-editor';\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\nimport { UMB_LINK_PICKER_MODAL, type UmbLinkPickerLink } from '@umbraco-cms/backoffice/multi-url-picker';\nimport {\n  TableData,\n  createEmptyTable,\n  createEmptyCell,\n  createEmptyRow\n} from './types.js';\n\nfunction getConfigValue<T>(config: UmbPropertyEditorConfigCollection | undefined, alias: string, defaultValue: T): T {\n  if (!config) return defaultValue;\n  const value = config.getValueByAlias(alias);\n  return (value !== undefined && value !== null) ? value as T : defaultValue;\n}\n\n@customElement('umbhost-table-property-editor')\nexport default class UmbHostTablePropertyEditor extends UmbElementMixin(LitElement) implements UmbPropertyEditorUiElement {\n  @property({ attribute: false }) public value: string | TableData = '';\n  @property({ type: Object, attribute: false }) public config?: UmbPropertyEditorConfigCollection;\n  @property({ type: Boolean, attribute: 'readonly' }) public readonly: boolean = false;\n\n  @state() private _tableData: TableData | null = null;\n  @state() private _editingCell: { row: number; col: number } | null = null;\n  \n  // Dragging State\n  @state() private _draggedRowIndex: number | null = null;\n  @state() private _draggedColIndex: number | null = null;\n\n  // Context Menu State\n  @state() private _contextMenu: { x: number; y: number; row: number; col: number } | null = null;\n\n  // Rich Text / Toolbar State\n  @state() private _toolbarPosition: { top: number; left: number } | null = null;\n  @state() private _viewSourceMode: boolean = false; // Tracks if current cell is in 'View Source' mode\n  \n  private _savedRange: Range | null = null;\n  private _savedSelection: { start: number; end: number; text: string } | null = null;\n  private _isLinkPickerOpen: boolean = false;\n\n  // Configuration getters\n  private _getdefaultRows() { return getConfigValue(this.config, 'defaultRows', 3); }\n  private _getdefaultColumns() { return getConfigValue(this.config, 'defaultColumns', 3); }\n  private _getminRows() { return getConfigValue(this.config, 'minRows', 1); }\n  private _getmaxRows() { return getConfigValue(this.config, 'maxRows', 0); }\n  private _getminColumns() { return getConfigValue(this.config, 'minColumns', 1); }\n  private _getmaxColumns() { return getConfigValue(this.config, 'maxColumns', 0); }\n  private _getshowFirstRowHeader() { return getConfigValue(this.config, 'showUseFirstRowAsHeader', true); }\n  private _getshowFirstColHeader() { return getConfigValue(this.config, 'showUseFirstColumnAsHeader', true); }\n  private _getEnableRichText() { return getConfigValue(this.config, 'enableRichText', true); }\n\n  override connectedCallback() {\n    super.connectedCallback();\n    this._parseValue();\n    window.addEventListener('click', this._closeContextMenu);\n    window.addEventListener('scroll', this._closeContextMenu, true); \n    document.addEventListener('selectionchange', this._handleSelectionChange);\n    document.addEventListener('mouseup', this._handleDocumentMouseup);\n    window.addEventListener('mousedown', this._handleOutsideClick);\n  }\n\n  override disconnectedCallback() {\n    super.disconnectedCallback();\n    window.removeEventListener('click', this._closeContextMenu);\n    window.removeEventListener('scroll', this._closeContextMenu, true);\n    document.removeEventListener('selectionchange', this._handleSelectionChange);\n    document.removeEventListener('mouseup', this._handleDocumentMouseup);\n    window.removeEventListener('mousedown', this._handleOutsideClick);\n  }\n\n  private _closeContextMenu = () => {\n      if (this._contextMenu) {\n          this._contextMenu = null;\n      }\n  }\n\n  // Fix for Bug 1: Close toolbar/editing when clicking outside\n  private _handleOutsideClick = (e: MouseEvent) => {\n      // If we aren't editing, do nothing\n      if (!this._editingCell) return;\n\n      // Check if the click path includes the table editor\n      // We use composedPath() to handle Shadow DOM boundaries\n      const path = e.composedPath();\n      const isInside = path.some(target => {\n          return target instanceof HTMLElement && target.classList.contains('table-editor');\n      });\n\n      // If click is outside the editor, close the toolbar and editing state\n      if (!isInside) {\n          // Save current work before closing\n          if (this._viewSourceMode) {\n              const { row, col } = this._editingCell;\n              const textarea = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-source-editor`) as HTMLTextAreaElement;\n              if (textarea) this._updateCellValue(row, col, textarea.value);\n          } else {\n              this._saveCellValue(this._editingCell.row, this._editingCell.col);\n          }\n\n          this._editingCell = null;\n          this._toolbarPosition = null;\n          this._viewSourceMode = false;\n      }\n  }\n\n  // --- Selection Handling ---\n\nprivate _handleSelectionChange = () => {\n      // 1. Skip if source mode or not editing\n      if (!this._editingCell || this._viewSourceMode) return;\n\n      // 2. Use our Shadow DOM aware helper\n      const selection = this._getSelection();\n      \n      // 3. Safety checks\n      if (!selection || selection.rangeCount === 0) return;\n\n      const range = selection.getRangeAt(0);\n      \n      // 4. FIX: Handle Text Nodes (which crash if you call .closest on them)\n      const containerNode = range.commonAncestorContainer;\n      \n      // If we are on a Text Node, get its parent Element. Otherwise use the Node as Element.\n      const elementToCheck = containerNode.nodeType === Node.TEXT_NODE \n          ? containerNode.parentElement \n          : containerNode as HTMLElement;\n\n      // 5. Ensure selection is actually inside our editor\n      const editor = this.shadowRoot?.querySelector('.table-editor');\n      \n      if (editor && elementToCheck && (editor.contains(elementToCheck) || this.shadowRoot?.contains(elementToCheck))) {\n          // Check if we are clicking the toolbar (don't save range for toolbar clicks)\n          const isToolbar = elementToCheck.closest('.formatting-toolbar');\n          \n          if (!isToolbar) {\n              this._savedRange = range.cloneRange();\n          }\n      }\n  }\n\n  // Capture selection for link picker on document mouseup\n  private _handleDocumentMouseup = () => {\n    if (!this._editingCell || this._viewSourceMode) return;\n    \n    const { row, col } = this._editingCell;\n    const cellContent = this.shadowRoot?.querySelector(\n      `[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`\n    ) as HTMLElement;\n    \n    if (!cellContent) return;\n    \n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0) return;\n    \n    const selectedText = selection.toString();\n    if (selectedText.length === 0) return;\n    \n    const range = selection.getRangeAt(0);\n    \n    try {\n      const preSelectionRange = document.createRange();\n      preSelectionRange.selectNodeContents(cellContent);\n      preSelectionRange.setEnd(range.startContainer, range.startOffset);\n      const start = preSelectionRange.toString().length;\n      \n      this._savedSelection = {\n        start: start,\n        end: start + selectedText.length,\n        text: selectedText\n      };\n    } catch (e) {\n      // Selection not in cell content, ignore\n    }\n  };\n\n  private _parseValue() {\n    if (!this.value) {\n      this._tableData = createEmptyTable(this._getdefaultRows(), this._getdefaultColumns());\n      return;\n    }\n    if (typeof this.value === 'string') {\n      try {\n        this._tableData = JSON.parse(this.value) as TableData;\n      } catch {\n        this._tableData = createEmptyTable(this._getdefaultRows(), this._getdefaultColumns());\n      }\n    } else {\n      this._tableData = this.value as TableData;\n    }\n  }\n\n  private _updateValue() {\n    if (!this._tableData) return;\n    const newValue = JSON.stringify(this._tableData);\n    this.value = newValue;\n    this.dispatchEvent(new CustomEvent('property-value-change', { detail: { value: newValue }, bubbles: true, composed: true }));\n  }\n\n  // --- Logic: Add / Delete / Insert ---\n\n  private _addRow() {\n     if (!this._tableData) return;\n     this._insertRowAt(this._tableData.rows.length);\n  }\n\n  private _addColumn() {\n     if (!this._tableData) return;\n     const colCount = this._tableData.rows[0]?.cells.length ?? 0;\n     this._insertColumnAt(colCount);\n  }\n\n  private _insertRowAt(index: number) {\n    if (!this._tableData) return;\n    const maxRows = this._getmaxRows();\n    if (maxRows > 0 && this._tableData.rows.length >= maxRows) return;\n    \n    const colCount = this._tableData.rows[0]?.cells.length ?? this._getdefaultColumns();\n    const newRow = createEmptyRow(colCount);\n    const newRows = [...this._tableData.rows];\n    newRows.splice(index, 0, newRow);\n    \n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateCellTypes();\n    this._updateValue();\n  }\n\n  private _insertColumnAt(index: number) {\n    if (!this._tableData) return;\n    const currentCols = this._tableData.rows[0]?.cells.length ?? 0;\n    const maxCols = this._getmaxColumns();\n    if (maxCols > 0 && currentCols >= maxCols) return;\n\n    const newRows = this._tableData.rows.map((row, rowIndex) => {\n      const isHeader = (this._tableData!.useFirstRowAsHeader && rowIndex === 0) || (this._tableData!.useFirstColumnAsHeader && index === 0);\n      const newCells = [...row.cells];\n      newCells.splice(index, 0, createEmptyCell(isHeader));\n      return { ...row, cells: newCells };\n    });\n\n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateCellTypes(); \n    this._updateValue();\n  }\n\n  private _deleteRow(index: number) {\n      if (!this._tableData) return;\n      if (this._tableData.rows.length <= this._getminRows()) return;\n\n      const newRows = [...this._tableData.rows];\n      newRows.splice(index, 1);\n      this._tableData = { ...this._tableData, rows: newRows };\n      this._updateCellTypes();\n      this._updateValue();\n  }\n\n  private _deleteColumn(index: number) {\n      if (!this._tableData) return;\n      const currentCols = this._tableData.rows[0]?.cells.length ?? 0;\n      if (currentCols <= this._getminColumns()) return;\n\n      const newRows = this._tableData.rows.map(row => {\n          const newCells = [...row.cells];\n          newCells.splice(index, 1);\n          return { ...row, cells: newCells };\n      });\n\n      this._tableData = { ...this._tableData, rows: newRows };\n      this._updateCellTypes();\n      this._updateValue();\n  }\n\n  private _updateCellTypes() {\n    if (!this._tableData) return;\n    const newRows = this._tableData.rows.map((row, rowIndex) => ({\n      ...row,\n      cells: row.cells.map((cell, colIndex) => ({\n        ...cell,\n        type: (this._tableData!.useFirstRowAsHeader && rowIndex === 0) || (this._tableData!.useFirstColumnAsHeader && colIndex === 0) ? 'Th' as const : 'Td' as const\n      }))\n    }));\n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateValue();\n  }\n\n  private _updateCellValue(row: number, col: number, value: string) {\n    if (!this._tableData) return;\n    const currentVal = this._tableData.rows[row]?.cells[col]?.value;\n    if (currentVal === value) return;\n\n    const newRows = this._tableData.rows.map((r, ri) => ri !== row ? r : { ...r, cells: r.cells.map((c, ci) => ci !== col ? c : { ...c, value }) });\n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateValue();\n  }\n\n  private _toggleFirstRowHeader() {\n    if (!this._tableData || this.readonly) return;\n    this._tableData = { ...this._tableData, useFirstRowAsHeader: !this._tableData.useFirstRowAsHeader };\n    this._updateCellTypes();\n  }\n\n  private _toggleFirstColumnHeader() {\n    if (!this._tableData || this.readonly) return;\n    this._tableData = { ...this._tableData, useFirstColumnAsHeader: !this._tableData.useFirstColumnAsHeader };\n    this._updateCellTypes();\n  }\n\n  // --- Rich Text Logic ---\n\n  private _execCommand(command: string, value: string | undefined = undefined) {\n    if (!this._editingCell || this._viewSourceMode) return;\n\n    const { row, col } = this._editingCell;\n    const cellEl = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`) as HTMLElement;\n    \n    // Restore selection immediately before command\n    if (cellEl) cellEl.focus();\n    if (this._savedRange) {\n        const selection = window.getSelection();\n        if (selection) {\n            selection.removeAllRanges();\n            selection.addRange(this._savedRange);\n        }\n    }\n    \n    document.execCommand(command, false, value);\n    \n    // Save AFTER command execution to persist the HTML change\n    this._saveCellValue(row, col);\n  }\n\n  private _formatBold() { this._execCommand('bold'); }\n  private _formatItalic() { this._execCommand('italic'); }\n  private _formatUnderline() { this._execCommand('underline'); }\n  private _alignLeft() { this._execCommand('justifyLeft'); }\n  private _alignCenter() { this._execCommand('justifyCenter'); }\n  private _alignRight() { this._execCommand('justifyRight'); }\n\n  // --- Link Picker ---\n\n  private async _insertLink() {\n    if (!this._editingCell || this._viewSourceMode) return;\n    \n    const { row, col } = this._editingCell;\n    const cellContent = this.shadowRoot?.querySelector(\n      `[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`\n    ) as HTMLElement;\n    \n    if (!cellContent) return;\n    \n    const selectedText = this._savedSelection?.text || '';\n    \n    this._isLinkPickerOpen = true;\n    \n    const modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\n    if (!modalManager) {\n      this._isLinkPickerOpen = false;\n      this._savedSelection = null;\n      return;\n    }\n    \n    const modal = modalManager.open(this, UMB_LINK_PICKER_MODAL, {\n      data: {\n        config: {},\n        index: null,\n        isNew: true\n      },\n      value: {\n        link: {\n          name: selectedText,\n          url: '',\n          target: '',\n          type: null,\n          unique: '',\n          queryString: ''\n        } as UmbLinkPickerLink\n      }\n    });\n\n    const result = await modal.onSubmit().catch(() => null);\n    \n    this._isLinkPickerOpen = false;\n    \n    if (result?.link) {\n      this._applyLink(result.link, cellContent);\n    } else {\n      this._savedSelection = null;\n    }\n  }\n\n  private _applyLink(link: UmbLinkPickerLink, cellContent: HTMLElement) {\n    let url = link.url || '';\n    if (link.queryString) {\n      url += (url.includes('?') ? '&' : '?') + link.queryString.replace(/^\\?/, '');\n    }\n\n    if (!url) {\n      this._savedSelection = null;\n      return;\n    }\n\n    const targetAttr = link.target === '_blank' ? ' target=\"_blank\" rel=\"noopener noreferrer\"' : '';\n    const linkText = this._savedSelection?.text || link.name || url;\n    const anchorHtml = `<a href=\"${url}\"${targetAttr}>${this._escapeHtml(linkText)}</a>`;\n\n    if (this._savedSelection && this._savedSelection.text) {\n      // Replace the selected text with the link\n      const currentHtml = cellContent.innerHTML;\n      const { start, end } = this._savedSelection;\n      \n      // Get text content to find positions\n      const textContent = cellContent.textContent || '';\n      \n      // Simple case: plain text content\n      if (currentHtml === this._escapeHtml(textContent) || currentHtml === textContent) {\n        const before = textContent.substring(0, start);\n        const after = textContent.substring(end);\n        cellContent.innerHTML = this._escapeHtml(before) + anchorHtml + this._escapeHtml(after);\n      } else {\n        // Has HTML - just append the link\n        cellContent.innerHTML = currentHtml + ' ' + anchorHtml;\n      }\n    } else {\n      // No selection - append a new link\n      cellContent.innerHTML += anchorHtml;\n    }\n    \n    // Save immediately to data\n    if (this._editingCell) {\n      const { row, col } = this._editingCell;\n      this._updateCellValue(row, col, cellContent.innerHTML);\n    }\n    \n    this._savedSelection = null;\n    cellContent.focus();\n  }\n\n  private _escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  private _removeLink() {\n    this._execCommand('unlink');\n  }\n\n  // --- View Source Logic ---\n  \n// Fix for Bug 2: Handle data transfer and re-rendering between modes\n  private async _toggleViewSource() {\n      if (!this._editingCell) return;\n      const { row, col } = this._editingCell;\n\n      if (this._viewSourceMode) {\n          // --- Switching FROM Source TO Rich Text ---\n          \n          // 1. Capture value from textarea\n          const textarea = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-source-editor`) as HTMLTextAreaElement;\n          let currentValue = '';\n          \n          if (textarea) {\n              currentValue = textarea.value;\n              this._updateCellValue(row, col, currentValue);\n          } else {\n              currentValue = this._tableData?.rows[row]?.cells[col]?.value || '';\n          }\n\n          // 2. Change mode\n          this._viewSourceMode = false;\n\n          // 3. Wait for Lit to render (textarea -> div)\n          await this.updateComplete;\n\n          // 4. Manually populate the new div\n          // We must do this manually because _syncCellContents skips the active editing cell\n          const cellEl = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`) as HTMLElement;\n          if (cellEl) {\n              cellEl.innerHTML = currentValue;\n              cellEl.focus();\n              \n              // Re-calculate toolbar position now that the div is back\n              const td = cellEl.closest('td') as HTMLElement;\n              if (td) this._updateToolbarPosition(td);\n          }\n\n      } else {\n          // --- Switching FROM Rich Text TO Source ---\n          \n          // 1. Save current HTML\n          this._saveCellValue(row, col);\n          \n          // 2. Change mode\n          this._viewSourceMode = true;\n          \n          // 3. Wait for render (div -> textarea)\n          await this.updateComplete;\n          \n          // 4. Focus the new textarea\n          const textarea = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-source-editor`) as HTMLTextAreaElement;\n          if (textarea) textarea.focus();\n      }\n  }\n\n  private _handleSourceChange(e: Event, row: number, col: number) {\n      const target = e.target as HTMLTextAreaElement;\n      this._updateCellValue(row, col, target.value);\n  }\n\n  // --- Context Menu Handlers ---\n\n  private _handleContextMenu(e: MouseEvent, row: number, col: number) {\n      if (this.readonly) return;\n      e.preventDefault(); \n      \n      this._contextMenu = {\n          x: e.clientX,\n          y: e.clientY,\n          row,\n          col\n      };\n  }\n\n  private _handleMenuAction(action: string) {\n      if (!this._contextMenu) return;\n      const { row, col } = this._contextMenu;\n\n      switch(action) {\n          case 'insert-row-before': this._insertRowAt(row); break;\n          case 'insert-row-after': this._insertRowAt(row + 1); break;\n          case 'insert-col-before': this._insertColumnAt(col); break;\n          case 'insert-col-after': this._insertColumnAt(col + 1); break;\n          case 'delete-row': this._deleteRow(row); break;\n          case 'delete-col': this._deleteColumn(col); break;\n      }\n      this._closeContextMenu();\n  }\n\n\n  // --- ROW Drag and Drop ---\n\n  private _handleRowDragStart(e: DragEvent, index: number) {\n    if (this.readonly) return;\n    \n    this._draggedRowIndex = index;\n    if (e.dataTransfer) {\n      e.dataTransfer.effectAllowed = 'move';\n      e.dataTransfer.setData('text/plain', `row:${index}`);\n\n      const target = e.target as HTMLElement;\n      const row = target.closest('tr');\n      if (row) {\n         e.dataTransfer.setDragImage(row, 0, 0);\n      }\n    }\n  }\n\n  private _handleRowDrop(e: DragEvent, targetIndex: number) {\n    if (this.readonly || this._draggedRowIndex === null) return;\n    e.preventDefault();\n\n    const fromIndex = this._draggedRowIndex;\n    const toIndex = targetIndex;\n\n    if (fromIndex !== toIndex) {\n      this._moveRow(fromIndex, toIndex);\n    }\n    this._draggedRowIndex = null;\n  }\n\n  private _moveRow(fromIndex: number, toIndex: number) {\n    if (!this._tableData) return;\n    const newRows = [...this._tableData.rows];\n    const [movedRow] = newRows.splice(fromIndex, 1);\n    newRows.splice(toIndex, 0, movedRow);\n    \n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateCellTypes(); \n    this._updateValue();\n  }\n\n  // --- COLUMN Drag and Drop ---\n\n  private _handleColDragStart(e: DragEvent, index: number) {\n    if (this.readonly) return;\n\n    this._draggedColIndex = index;\n    if (e.dataTransfer) {\n      e.dataTransfer.effectAllowed = 'move';\n      e.dataTransfer.setData('text/plain', `col:${index}`);\n    }\n  }\n\n  private _handleColDrop(e: DragEvent, targetIndex: number) {\n    if (this.readonly || this._draggedColIndex === null) return;\n    e.preventDefault();\n\n    const fromIndex = this._draggedColIndex;\n    const toIndex = targetIndex;\n\n    if (fromIndex !== toIndex) {\n        this._moveColumn(fromIndex, toIndex);\n    }\n    this._draggedColIndex = null;\n  }\n\n  private _moveColumn(fromIndex: number, toIndex: number) {\n    if (!this._tableData) return;\n    const newRows = this._tableData.rows.map(row => {\n        const newCells = [...row.cells];\n        const [movedCell] = newCells.splice(fromIndex, 1);\n        newCells.splice(toIndex, 0, movedCell);\n        return { ...row, cells: newCells };\n    });\n\n    this._tableData = { ...this._tableData, rows: newRows };\n    this._updateCellTypes();\n    this._updateValue();\n  }\n\n  private _handleDragOver(e: DragEvent) {\n    if (this.readonly) return;\n    e.preventDefault();\n    if (e.dataTransfer) {\n      e.dataTransfer.dropEffect = 'move';\n    }\n  }\n\n  private _getSelection(): Selection | null {\n    const root = this.shadowRoot as any; // Cast to any to allow access to getSelection\n    if (root && typeof root.getSelection === 'function') {\n        return root.getSelection(); \n    }\n    return window.getSelection();\n  }\n\nprivate _toggleLinkClass() {\n    if (!this._editingCell || this._viewSourceMode) return;\n    \n    // 1. Restore the selection if we have a saved range\n    if (this._savedRange) {\n        const selection = this._getSelection();\n        if (selection) {\n            selection.removeAllRanges();\n            selection.addRange(this._savedRange);\n        }\n    }\n\n    // 2. Get selection from Shadow Root or Window\n    const selection = this._getSelection();\n    if (!selection || selection.rangeCount === 0) return;\n\n    const range = selection.getRangeAt(0);\n    const container = range.commonAncestorContainer;\n\n    // 3. Resolve the element (Handle Text Nodes vs Elements)\n    const element = container.nodeType === Node.TEXT_NODE \n        ? container.parentElement \n        : container as HTMLElement;\n\n    if (!element) return;\n\n    // 4. Find the Anchor\n    // Case A: Cursor is inside the link, or text is highlighted\n    let anchor = element.closest('a');\n\n    // Case B: The Link Element itself is highlighted (Selection is around the tag)\n    if (!anchor) {\n        const fragment = range.cloneContents();\n        if (fragment.querySelector('a')) {\n            anchor = element.querySelector('a');\n            // Ensure the found anchor is actually relevant to the selection\n            if (anchor && !selection.containsNode(anchor, true)) {\n                anchor = null;\n            }\n        }\n    }\n\n    // 5. Toggle Class\n    if (anchor) {\n        if (anchor.classList.contains('btn-primary')) {\n            anchor.classList.remove('btn', 'btn-primary');\n        } else {\n            anchor.classList.add('btn', 'btn-primary');\n        }\n        \n        // 6. Save changes\n        const { row, col } = this._editingCell;\n        this._saveCellValue(row, col);\n    }\n  }\n  // --- Editing Logic ---\n\n  private _updateToolbarPosition(cellEl: HTMLElement) {\n      const container = this.shadowRoot?.querySelector('.table-editor') as HTMLElement;\n      if (!container || !cellEl) return;\n\n      const cellRect = cellEl.getBoundingClientRect();\n      const containerRect = container.getBoundingClientRect();\n\n      let top = cellRect.top - containerRect.top - 65; \n      let left = cellRect.left - containerRect.left;\n\n      if (top < 0) {\n          top = cellRect.bottom - containerRect.top + 4;\n      }\n\n      this._toolbarPosition = { top, left };\n  }\n\n  private _handleCellClick(e: MouseEvent, row: number, col: number) {\n    if (this.readonly) return;\n    if (e.button === 2) return;\n\n    // Check if clicking inside source editor to avoid reset\n    const target = e.target as HTMLElement;\n    if (target.classList.contains('cell-source-editor')) return;\n\n    // Prevent link navigation\n    if (target.tagName === 'A' || target.closest('a')) {\n      e.preventDefault();\n    }\n\n    if (this._editingCell?.row === row && this._editingCell?.col === col) {\n        const cellEl = e.target as HTMLElement;\n        const actualCell = cellEl.closest('.cell') as HTMLElement;\n        if (actualCell) this._updateToolbarPosition(actualCell);\n        return;\n    }\n\n    // Changing cells - save old cell first\n    if (this._editingCell) {\n      this._saveCellValue(this._editingCell.row, this._editingCell.col);\n    }\n\n    this._editingCell = { row, col };\n    this._viewSourceMode = false; // Reset source mode when switching cells\n\n    this.updateComplete.then(() => {\n      const cellEl = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`) as HTMLElement;\n      if (cellEl) {\n        cellEl.focus();\n        \n        // Calculate toolbar position\n        const td = cellEl.closest('td') as HTMLElement;\n        if(td) this._updateToolbarPosition(td);\n      }\n    });\n  }\n\n  private _handleCellContentClick(e: MouseEvent) {\n    const target = e.target as HTMLElement;\n    if (target.tagName === 'A' || target.closest('a')) {\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  private _handleCellBlur(row: number, col: number) {\n    if (this._isLinkPickerOpen) return;\n    \n    requestAnimationFrame(() => {\n        // Only close if we truly left the cell context\n        // If viewSourceMode is on, we don't auto-close on blur of textarea easily because \n        // clicking toolbar might blur textarea.\n        if (this._editingCell?.row === row && this._editingCell?.col === col) {\n             \n             // If clicking toolbar, do not close. Toolbar prevents default, so focus remains?\n             // Actually, if we click outside the table editor entirely, we should close.\n             \n             // For now, we will be aggressive on saving, but lax on closing editingCell \n             // to keep toolbar open. \n             // If we want to close the toolbar when clicking outside, we rely on _handleDocumentClick or similar \n             // which is hard in Shadow DOM.\n             \n             // Basic implementation: Save, but don't force nullify unless we move to another cell.\n             if (this._viewSourceMode) {\n                 const textarea = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-source-editor`) as HTMLTextAreaElement;\n                 if(textarea) this._updateCellValue(row, col, textarea.value);\n             } else {\n                 this._saveCellValue(row, col);\n             }\n             \n             // Optional: Close editing if we are sure? \n             // For sticky toolbar, we usually keep it open until another cell is clicked.\n             // this._editingCell = null; \n             // this._toolbarPosition = null; \n        }\n    });\n  }\n\n  private _handleCellKeydown(e: KeyboardEvent, row: number, col: number) {\n    if (this._viewSourceMode) return; // Allow normal typing in source mode\n\n    if (e.ctrlKey || e.metaKey) {\n        if (['b', 'i', 'u'].includes(e.key.toLowerCase())) return; \n    }\n\n    if (e.key === 'Tab') {\n      e.preventDefault();\n      this._saveCellValue(row, col);\n\n      const rowCount = this._tableData?.rows.length ?? 0;\n      const colCount = this._tableData?.rows[0]?.cells.length ?? 0;\n      let nextRow = row;\n      let nextCol = col + (e.shiftKey ? -1 : 1);\n\n      if (nextCol >= colCount) { nextCol = 0; nextRow++; }\n      else if (nextCol < 0) { nextCol = colCount - 1; nextRow--; }\n\n      if (nextRow >= 0 && nextRow < rowCount) {\n        this._editingCell = { row: nextRow, col: nextCol };\n        this._viewSourceMode = false;\n        \n        this.updateComplete.then(() => {\n          const cellEl = this.shadowRoot?.querySelector(`[data-row=\"${nextRow}\"][data-col=\"${nextCol}\"] .cell-content`) as HTMLElement;\n          if (cellEl) {\n             cellEl.focus();\n             const td = cellEl.closest('td') as HTMLElement;\n             if(td) this._updateToolbarPosition(td);\n          }\n        });\n      }\n    }\n  }\n\n  private _saveCellValue(row: number, col: number) {\n    if (row < 0 || col < 0) return;\n    const cellEl = this.shadowRoot?.querySelector(`[data-row=\"${row}\"][data-col=\"${col}\"] .cell-content`) as HTMLElement;\n    if (!cellEl) return;\n    this._updateCellValue(row, col, cellEl.innerHTML);\n  }\n\n  // --- Render ---\n\n  private _renderContextMenu() {\n      if (!this._contextMenu) return nothing;\n      \n      return html`\n        <div class=\"context-menu\" style=\"top: ${this._contextMenu.y}px; left: ${this._contextMenu.x}px;\" @click=${(e: Event) => e.stopPropagation()}>\n            <div class=\"menu-item\" @click=${() => this._handleMenuAction('insert-row-before')}>Insert Row Before</div>\n            <div class=\"menu-item\" @click=${() => this._handleMenuAction('insert-row-after')}>Insert Row After</div>\n            <div class=\"menu-divider\"></div>\n            <div class=\"menu-item\" @click=${() => this._handleMenuAction('insert-col-before')}>Insert Column Before</div>\n            <div class=\"menu-item\" @click=${() => this._handleMenuAction('insert-col-after')}>Insert Column After</div>\n            <div class=\"menu-divider\"></div>\n            <div class=\"menu-item danger\" @click=${() => this._handleMenuAction('delete-row')}>Delete Row</div>\n            <div class=\"menu-item danger\" @click=${() => this._handleMenuAction('delete-col')}>Delete Column</div>\n        </div>\n      `;\n  }\n\n  private _renderFormattingToolbar() {\n    if (!this._toolbarPosition) return nothing;\n\n    const style = `top: ${this._toolbarPosition.top}px; left: ${this._toolbarPosition.left}px;`;\n\n    // Handle button clicks with stopPropagation to prevent focus loss issues logic upstream\n    const handleBtnClick = (e: MouseEvent, action: () => void) => {\n        e.preventDefault(); \n        e.stopPropagation();\n        action();\n    };\n\n    return html`\n      <div class=\"formatting-toolbar\" style=\"${style}\" @mousedown=${(e: MouseEvent) => { e.preventDefault(); e.stopPropagation(); }}>\n        <div class=\"format-group\">\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._formatBold())} title=\"Bold\"><strong>B</strong></button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._formatItalic())} title=\"Italic\"><em>I</em></button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._formatUnderline())} title=\"Underline\"><span style=\"text-decoration:underline\">U</span></button>\n        </div>\n        <div class=\"format-divider\"></div>\n        <div class=\"format-group\">\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._alignLeft())} title=\"Align Left\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\"><path d=\"M2 3h12v1H2V3zm0 3h8v1H2V6zm0 3h12v1H2V9zm0 3h8v1H2v-1z\"/></svg>\n          </button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._alignCenter())} title=\"Align Center\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\"><path d=\"M2 3h12v1H2V3zm2 3h8v1H4V6zm-2 3h12v1H2V9zm2 3h8v1H4v-1z\"/></svg>\n          </button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._alignRight())} title=\"Align Right\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\"><path d=\"M2 3h12v1H2V3zm4 3h8v1H6V6zm-4 3h12v1H2V9zm4 3h8v1H6v-1z\"/></svg>\n          </button>\n        </div>\n        <div class=\"format-divider\"></div>\n        <div class=\"format-group\">\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._insertLink())} title=\"Insert Link\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\"><path d=\"M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z\"/><path d=\"M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z\"/></svg>\n          </button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._toggleLinkClass())} title=\"Toggle Button Style\">\n             <span style=\"font-size: 10px; font-weight: bold; border: 1px solid currentColor; padding: 0 2px; border-radius: 2px;\">BTN</span>\n          </button>\n          <button type=\"button\" class=\"format-btn\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._removeLink())} title=\"Remove Link\">\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"currentColor\"><path d=\"M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z\"/><path d=\"M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z\"/><path d=\"M2 2l12 12\" stroke=\"currentColor\" stroke-width=\"1.5\"/></svg>\n          </button>\n        </div>\n        <div class=\"format-divider\"></div>\n        <div class=\"format-group\">\n           <button type=\"button\" class=\"format-btn ${this._viewSourceMode ? 'active' : ''}\" @click=${(e: MouseEvent) => handleBtnClick(e, () => this._toggleViewSource())} title=\"View Source\">\n             <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><polyline points=\"16 18 22 12 16 6\"></polyline><polyline points=\"8 6 2 12 8 18\"></polyline></svg>\n           </button>\n        </div>\n      </div>\n    `;\n  }\n\n  override updated(changedProperties: Map<string, unknown>) {\n    super.updated(changedProperties);\n    this._syncCellContents();\n  }\n\n  private _syncCellContents() {\n    if (!this._tableData) return;\n    \n    // Set innerHTML directly to avoid Lit comment markers\n    this._tableData.rows.forEach((row, ri) => {\n      row.cells.forEach((cell, ci) => {\n        // Don't sync the cell that's being edited (user is typing)\n        const isEditing = this._editingCell?.row === ri && this._editingCell?.col === ci;\n        if (isEditing) return;\n        \n        const cellContent = this.shadowRoot?.querySelector(\n          `[data-row=\"${ri}\"][data-col=\"${ci}\"] .cell-content`\n        ) as HTMLElement;\n        \n        if (cellContent && cellContent.innerHTML !== (cell.value || '')) {\n          cellContent.innerHTML = cell.value || '';\n        }\n      });\n    });\n  }\n\n  override render() {\n    if (!this._tableData) return html`<div>Loading...</div>`;\n\n    const colCount = this._tableData.rows[0]?.cells.length ?? 0;\n    const colIndices = Array.from({ length: colCount }, (_, i) => i);\n\n    return html`\n      <div class=\"table-editor\">\n        ${this._renderContextMenu()}\n      \n        <div class=\"toolbar\">\n          <div class=\"toolbar-left\">\n            ${!this.readonly ? html`\n              <uui-button look=\"outline\" label=\"Add Row\" @click=${() => this._addRow()}>Add Row</uui-button>\n              <uui-button look=\"outline\" label=\"Add Column\" @click=${() => this._addColumn()}>Add Column</uui-button>\n            ` : nothing}\n          </div>\n          <div class=\"toolbar-right\">\n            ${this._getshowFirstRowHeader() ? html`<uui-toggle label=\"First row is header\" ?checked=${this._tableData.useFirstRowAsHeader} ?disabled=${this.readonly} @change=${this._toggleFirstRowHeader}></uui-toggle>` : nothing}\n            ${this._getshowFirstColHeader() ? html`<uui-toggle label=\"First column is header\" ?checked=${this._tableData.useFirstColumnAsHeader} ?disabled=${this.readonly} @change=${this._toggleFirstColumnHeader}></uui-toggle>` : nothing}\n          </div>\n        </div>\n\n        ${this._getEnableRichText() && this._editingCell && !this.readonly ? this._renderFormattingToolbar() : nothing}\n\n        <div class=\"table-container\">\n          <table>\n            <tr class=\"col-handle-row\">\n                <td class=\"corner-cell\"></td>\n                ${colIndices.map((ci) => html`\n                    <td class=\"col-handle-cell ${this._draggedColIndex === ci ? 'dragging' : ''}\"\n                        draggable=\"${!this.readonly}\"\n                        @dragstart=${(e: DragEvent) => this._handleColDragStart(e, ci)}\n                        @dragover=${this._handleDragOver}\n                        @drop=${(e: DragEvent) => this._handleColDrop(e, ci)}\n                        @contextmenu=${(e: MouseEvent) => this._handleContextMenu(e, 0, ci)}\n                    >\n                        <div class=\"col-drag-handle\" title=\"Drag to reorder column\">≡</div>\n                    </td>\n                `)}\n            </tr>\n\n            ${this._tableData.rows.map((row, ri) => html`\n              <tr \n                @dragover=${this._handleDragOver}\n                @drop=${(e: DragEvent) => this._handleRowDrop(e, ri)}\n                class=\"${this._draggedRowIndex === ri ? 'dragging' : ''}\"\n              >\n                <td class=\"handle-cell\"\n                    draggable=\"${!this.readonly}\"\n                    @dragstart=${(e: DragEvent) => this._handleRowDragStart(e, ri)}\n                    @contextmenu=${(e: MouseEvent) => this._handleContextMenu(e, ri, 0)}\n                >\n                   <div class=\"row-drag-handle\" title=\"Drag to reorder row\">≡</div>\n                </td>\n\n                ${row.cells.map((cell, ci) => {\n                    const isEditing = !this.readonly && this._editingCell?.row === ri && this._editingCell?.col === ci;\n                    \n                    return html`\n                        <td class=\"cell ${cell.type === 'Th' ? 'header-cell' : ''} ${isEditing ? 'editing' : ''}\" \n                            data-row=\"${ri}\" \n                            data-col=\"${ci}\"\n                            @click=${(e: MouseEvent) => this._handleCellClick(e, ri, ci)}\n                            @contextmenu=${(e: MouseEvent) => this._handleContextMenu(e, ri, ci)}\n                            >\n                            ${isEditing && this._viewSourceMode ? \n                                html`\n                                <textarea class=\"cell-source-editor\"\n                                          .value=${cell.value || ''}\n                                          @blur=${() => this._handleCellBlur(ri, ci)}\n                                          @input=${(e: Event) => this._handleSourceChange(e, ri, ci)}\n                                ></textarea>\n                                ` \n                                : \n                                html`\n                                <div class=\"cell-content\" \n                                    contenteditable=\"${isEditing ? 'true' : 'false'}\"\n                                    @blur=${() => this._handleCellBlur(ri, ci)}\n                                    @keydown=${(e: KeyboardEvent) => this._handleCellKeydown(e, ri, ci)}\n                                    @click=${(e: MouseEvent) => this._handleCellContentClick(e)}\n                                ></div>\n                                `\n                            }\n                        </td>\n                    `;\n                })}\n              </tr>\n            `)}\n          </table>\n        </div>\n      </div>\n    `;\n  }\n\n  static override styles = css`\n    :host { display: block; font-family: var(--uui-font-family, inherit); }\n    .table-editor { display: flex; flex-direction: column; gap: 12px; position: relative; }\n    \n    .toolbar { \n        position: sticky; \n        top: 0; \n        z-index: 10; \n        display: flex; \n        justify-content: space-between; \n        align-items: center; \n        flex-wrap: wrap; \n        gap: 12px; \n        padding: 8px 12px; \n        background: var(--uui-color-surface-alt, #f3f3f5); \n        border-radius: var(--uui-border-radius, 3px); \n        border-bottom: 1px solid var(--uui-color-border, #d8d7d9);\n    }\n    .toolbar-left, .toolbar-right { display: flex; align-items: center; gap: 12px; }\n\n    /* Rich Text Toolbar Styles */\n    .formatting-toolbar { \n      position: absolute; \n      z-index: 50;\n      display: flex; align-items: center; gap: 4px; padding: 6px 10px; \n      background: var(--uui-color-surface, #fff); \n      border: 1px solid var(--uui-color-border, #d8d7d9); \n      border-radius: var(--uui-border-radius, 3px);\n      box-shadow: var(--uui-shadow-depth-3, 0 4px 12px rgba(0,0,0,0.15));\n      width: fit-content; \n    }\n    .format-group { display: flex; gap: 2px; }\n    .format-divider { width: 1px; height: 24px; background: var(--uui-color-border, #d8d7d9); margin: 0 6px; }\n    .format-btn { \n      display: flex; align-items: center; justify-content: center; \n      width: 32px; height: 32px; padding: 0; \n      background: transparent; border: 1px solid transparent; \n      border-radius: var(--uui-border-radius, 3px); \n      cursor: pointer; font-size: 14px; color: var(--uui-color-text, #1b264f);\n    }\n    .format-btn:hover { background: var(--uui-color-surface-alt, #f3f3f5); border-color: var(--uui-color-border, #d8d7d9); }\n    .format-btn:active { background: var(--uui-color-border, #d8d7d9); }\n    .format-btn.active { background: var(--uui-color-surface-emphasis, #f9f9fb); border-color: var(--uui-color-focus, #3544b1); }\n    \n    .table-container { overflow-x: auto; }\n    table { width: 100%; border-collapse: collapse; table-layout: fixed; }\n    \n    .cell { border: 1px solid var(--uui-color-border, #d8d7d9); padding: 0; vertical-align: top; min-width: 150px; background: var(--uui-color-surface, #fff); }\n    .cell.header-cell { background: var(--uui-color-surface-alt, #f3f3f5); font-weight: 600; }\n    .cell.editing { outline: 2px solid var(--uui-color-focus, #3544b1); outline-offset: -2px; z-index: 5; position: relative; }\n    \n    .cell-content { min-height: 40px; padding: 8px 12px; outline: none; display: block; word-break: break-word; }\n    .cell-content:focus { background: var(--uui-color-surface-emphasis, #f9f9fb); }\n    .cell-content[contenteditable=\"false\"] { cursor: pointer; }\n    .cell-content a { color: var(--uui-color-interactive, #3544b1); text-decoration: underline; }\n    .cell-content[contenteditable=\"true\"] a { pointer-events: none; cursor: text; }\n    \n    .cell-source-editor { width: 100%; min-height: 100px; border: none; background: #f9f9f9; padding: 8px; font-family: monospace; font-size: 13px; resize: vertical; box-sizing: border-box; outline: none; }\n\n    /* Visual feedback for the button class inside the editor */\n    .cell-content a.btn {\n        display: inline-block;\n        padding: 4px 8px;\n        text-decoration: none;\n        border-radius: 4px;\n        font-size: 0.9em;\n        line-height: 1;\n        cursor: pointer;\n    }\n    .cell-content a.btn-primary {\n        background-color: #007bff; /* Standard Bootstrap Primary Color */\n        color: white !important;   /* Force white text over blue */\n        border: 1px solid #007bff;\n    }\n\n    /* Drag Handles */\n    .handle-cell { \n        width: 30px; \n        min-width: 30px; \n        max-width: 30px; \n        background: var(--uui-color-surface-alt, #f3f3f5); \n        border: 1px solid var(--uui-color-border, #d8d7d9); \n        vertical-align: middle; \n        text-align: center; \n        cursor: grab; \n        transition: background-color 0.1s ease-in-out;\n    }\n    \n    .col-handle-cell {\n        height: 24px;\n        background: var(--uui-color-surface-alt, #f3f3f5);\n        border: 1px solid var(--uui-color-border, #d8d7d9);\n        text-align: center;\n        vertical-align: middle;\n        cursor: grab;\n    }\n    \n    .corner-cell {\n        background: var(--uui-color-surface-alt, #f3f3f5);\n        border: none;\n    }\n\n    .row-drag-handle, .col-drag-handle { \n        color: var(--uui-color-text-alt, #a1a1a1); \n        font-weight: bold; \n        user-select: none; \n    }\n    \n    .handle-cell:hover .row-drag-handle, \n    .col-handle-cell:hover .col-drag-handle { \n        color: var(--uui-color-text, #000); \n    }\n    \n    .dragging { opacity: 0.5; background: var(--uui-color-surface-emphasis, #f9f9fb); }\n    tr.dragging td { background: var(--uui-color-surface-emphasis, #f9f9fb); }\n\n    tr:not(.dragging):hover td.cell:not(.editing) {\n       background-color: var(--uui-color-surface-emphasis, #f9f9fb);\n    }\n    tr:not(.dragging):hover td.handle-cell {\n        background-color: var(--uui-color-surface-emphasis, #f9f9fb);\n    }\n\n    /* --- Context Menu Styles --- */\n    .context-menu {\n        position: fixed;\n        z-index: 9999;\n        background: var(--uui-color-surface, #fff);\n        border: 1px solid var(--uui-color-border, #d8d7d9);\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        border-radius: 4px;\n        padding: 4px 0;\n        min-width: 160px;\n        font-size: 14px;\n        color: var(--uui-color-text, #000);\n    }\n    \n    .menu-item {\n        padding: 8px 16px;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        transition: background-color 0.1s;\n    }\n    \n    .menu-item:hover {\n        background: var(--uui-color-surface-emphasis, #f9f9fb);\n    }\n\n    .menu-item.danger {\n        color: var(--uui-color-danger, #d42054);\n    }\n    \n    .menu-item.danger:hover {\n        background: var(--uui-color-danger, #d42054);\n        color: #ffffff;\n    }\n\n    .menu-divider {\n        height: 1px;\n        background: var(--uui-color-border, #e9e9eb);\n        margin: 4px 0;\n    }\n  `;\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'umbhost-table-property-editor': UmbHostTablePropertyEditor;\n  }\n}"],"names":["createEmptyCell","isHeader","createEmptyRow","columnCount","isHeaderRow","createEmptyTable","rowCount","useFirstRowAsHeader","useFirstColumnAsHeader","rows","i","row","j","isHeaderCell","getConfigValue","config","alias","defaultValue","value","UmbHostTablePropertyEditor","UmbElementMixin","LitElement","e","target","col","textarea","_a","selection","range","containerNode","elementToCheck","editor","_b","cellContent","selectedText","preSelectionRange","start","newValue","colCount","index","maxRows","newRow","newRows","currentCols","maxCols","rowIndex","newCells","cell","colIndex","r","ri","ci","command","cellEl","modalManager","UMB_MODAL_MANAGER_CONTEXT","result","UMB_LINK_PICKER_MODAL","link","url","targetAttr","linkText","anchorHtml","currentHtml","end","textContent","before","after","text","div","currentValue","_d","_c","_e","td","_f","action","targetIndex","fromIndex","toIndex","movedRow","movedCell","root","container","element","anchor","cellRect","containerRect","top","left","actualCell","nextRow","nextCol","html","nothing","style","handleBtnClick","changedProperties","colIndices","_","isEditing","css","__decorateClass","property","state","customElement"],"mappings":"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"}